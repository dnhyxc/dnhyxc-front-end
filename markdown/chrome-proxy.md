### webRequest 生命周期

webRequest 定义了一系列的事件来描述每一个请求的经历的心路历程，它们来到插件后，会有类似下面的生命周期：

每一个事件都代表一个生命周期的钩子，他们的含义如下：

onBeforeRequest：当一个请求将要发出的时候触发。这个事件会在 TCP 连接建立之前，因此我们可以用它来取消或者重定向一个请求。

onBeforeSendHeaders：当一个请求将要发出，并且请求头已经初始化完成的时候触发。这个事件允许我们增加、修改、删除请求头的某些字段。由于还没有发出，它也可以用来取消这个请求。

onSendHeaders：当请求头被 onBeforeSendHeaders 处理过之后，请求头就已经成形了。这个事件就会在请求头被发送至网络前触发，并且异步的执行。它将不再允许我们修改请求头，或者取消请求。

onHeadersReceived：当收到 http 或者 https 响应头的时候触发。需要注意的是，由于可能存在重定向和身份验证请求，一个请求可能会来到这里多次。这个事件允许我们去增加、修改、删除响应头的字段，比如 Content-Type；并且该事件允许你取消或者重定向该请求。

onAuthRequired：这个事件是当响应回来的时候，需要用户权限时触发，比如状态码为 401、407 的时候。这个事件允许你提供用户名、密码等去申请权限。需要注意的是，权限可能会错误，不要掉入死循环了，因为如果你提供的也错了，会继续返回 401，然后又被这个事件拦截，又错了，一直进行下去，所以一般都要事情计数器来控制一下。同时它也允许取消请求。

onBeforeRedirect：要重定向将要发出时触发。一个重定向的发生可能来自于一个 HTTP 级别的状态码，比如 301、302 等。它不允许你修改或者取消这个重定向的请求。

onResponseStarted：当响应体的第一个字节接收到的时候触发。它同时也意味着这个响应头是合法的。这个事件不允许取消或者修改请求了。

onCompleted：当一个请求完全成功结束后触发。

onErrorOccurred：上述过程中，任意一个出现错误后触发。

以上事件中，onCompleted、onErrorOccurred、onBeforeRedirect 都有可能成为生命周期的末尾。

https://juejin.cn/post/7281555897879642124
